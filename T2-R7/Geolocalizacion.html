<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Ubicación en el Mapa</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <style>
      /* 3. Definir un tamaño para el contenedor del mapa */
      #miMapa {
        height: 500px;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <h1>Mi Ubicación en el Mapa</h1>
    <p>
      Esta página te mostrará tu ubicación actual en un mapa. Por favor, permite
      que el navegador acceda a tu ubicación.
    </p>

    <div id="miMapa"></div>

    <script>
      // 5. Inicializar el mapa y centrarlo en una ubicación por defecto en mi caso he puesto el centro de España
      // El número 6 es el nivel de zoom inicial.
      var map = L.map("miMapa").setView([40.416775, -3.70379], 6);

      // 6. Añadir la capa de mapa de OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // 7. Usar la API de Geolocalización del navegador ya esta integrada en el navegador
      navigator.geolocation.getCurrentPosition(
        function (position) {
          // Obtener las coordenadas de latitud y longitud
          var lat = position.coords.latitude;
          var lon = position.coords.longitude;

          // Centrar el mapa en la ubicación del usuario con un zoom más cercano
          map.setView([lat, lon], 15);

          // Añadir un marcador en la ubicación del usuario
          L.marker([lat, lon]).addTo(map).bindPopup("¡Estás aquí!").openPopup();
          
        },
        function (error) {
          // Manejar errores si no se puede obtener la ubicación
          console.log("Error al obtener la ubicación: ", error);
          alert("No se pudo obtener tu ubicación.");
        }
      );
    </script>
  </body>
</html>
